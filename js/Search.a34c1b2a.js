(window.webpackJsonp=window.webpackJsonp||[]).push([["Search"],{2532:function(t,e,a){"use strict";var n=a("23e7"),r=a("e330"),s=a("5a34"),i=a("1d80"),c=a("577e"),o=a("ab13"),u=r("".indexOf);n({target:"String",proto:!0,forced:!o("includes")},{includes:function(t){return!!~u(c(i(this)),c(s(t)),arguments.length>1?arguments[1]:void 0)}})},"2d3b":function(t,e,a){"use strict";a.r(e);var n=a("b85c"),r=a("6b75");a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0"),a("a630");var s=a("06c5");function i(t){return function(t){if(Array.isArray(t))return Object(r.a)(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Object(s.a)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var c=a("5530"),o=(a("6062"),a("159b"),a("4e82"),a("caad"),a("2532"),a("b0c0"),a("4de4"),a("a15b"),a("a434"),a("58ff"));var u=a("aaef"),h=a("68fe"),l=a("229e"),d=a("2f62"),f={name:"Search",data:function(){return{value:"",hotSearch:["周杰伦","陈奕迅"],searchHistory:[],singer:[],songsData:[]}},created:function(){this.initHotSearchData(),this.initSearchHistory()},methods:Object(c.a)(Object(c.a)({addSongPlay:function(t){this.addPlay({songObj:t}),this.addSearchHistory()},addSearchHistory:function(){this.searchHistory.unshift(this.value);var t=new Set;this.searchHistory.forEach((function(e){t.add(e)})),this.searchHistory=i(t.values()),h.a.set(u.c,this.searchHistory)},initHotSearchData:function(){var t=this;Object(o.a)("/search/hot").then((function(e){if(200===e.code){var a=new Set;t.hotSearch.forEach((function(t){a.add(t)}));var r,s=Object(n.a)(e.result.hots);try{for(s.s();!(r=s.n()).done;){var c=r.value;a.add(c.first)}}catch(t){s.e(t)}finally{s.f()}t.hotSearch=i(a.values())}else t.hotSearch.push("陈奕迅","周杰伦","国际歌","我们的爱","裙下之臣","21 guns"),t.hotSearch.sort((function(){return Math.random()-.5}))}))},searchThis:function(t){this.value=t,this.onSearch(t)},initSearchHistory:function(){this.searchHistory=h.a.get(u.c)||[]},onSearch:function(t){var e,a=this,r=this;this.songsData.length=0,this.singer.length=0,(e=t,Object(o.a)("/search?keywords="+e)).then((function(t){if(200===t.code){if(a.joinArtists(t.result.songs[0].artists).includes(a.value)){var e=0;t.result.songs[0].artists.forEach((function(t){t.name===a.value&&(e=t.id)}));var s={id:e,name:r.value};a.singer.push(s)}var i,c=[],o=Object(n.a)(t.result.songs);try{for(o.s();!(i=o.n()).done;){var u=i.value,h={artists:u.artists,mid:u.id,name:u.name,fee:u.fee,album:u.album};c.push(h)}}catch(t){o.e(t)}finally{o.f()}var d=c.filter((function(t){return 8===t.fee}));a.songsData=d,d.length?a.songsData=d:a.songsData.push({error:!0,msg:"没有可播放的歌曲"})}a.$nextTick((function(){a.scroll=new l.a(".search-result",{click:!0,tap:"tap"})}))}))},joinArtists:function(t){var e,a=[],r=Object(n.a)(t);try{for(r.s();!(e=r.n()).done;){var s=e.value;a.push(s.name)}}catch(t){r.e(t)}finally{r.f()}return a.join("/")},toSingerPage:function(t){h.a.set(u.d,this.singer[0]),this.addSearchHistory(),this.$router.push({path:"/singer/".concat(t)})}},Object(d.b)(["addPlay"])),{},{deleteThis:function(t){this.searchHistory.splice(t,1),h.a.set(u.c,this.searchHistory)},deleteAll:function(){var t=this;0!==this.searchHistory.length&&this.$dialog.confirm({title:"清空所有搜索历史"}).then((function(){t.searchHistory=[],h.a.set(u.c,t.searchHistory)})).catch((function(){}))}})},v=(a("8880"),a("2877")),g=Object(v.a)(f,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"search"},[a("van-search",{staticClass:"searchBar",attrs:{"clear-trigger":"always",placeholder:"搜索歌曲、歌手",shape:"round",background:"#222"},on:{search:function(e){return t.onSearch(t.value)},blur:function(e){return t.onSearch(t.value)}},model:{value:t.value,callback:function(e){t.value="string"==typeof e?e.trim():e},expression:"value"}}),a("div",{staticClass:"hot"},[a("p",[t._v("热门搜索")]),t._l(t.hotSearch,(function(e){return a("span",{key:e.id,staticClass:"keyword",on:{click:function(a){return t.searchThis(e)}}},[t._v(" "+t._s(e)+" ")])}))],2),a("div",{staticClass:"history"},[a("div",{staticClass:"first"},[a("p",[t._v("搜索历史")]),a("van-icon",{attrs:{name:"delete-o"},on:{click:t.deleteAll}})],1),t._l(t.searchHistory,(function(e,n){return a("div",{key:e.id,staticClass:"search-history"},[a("p",[t._v(t._s(e))]),a("van-icon",{attrs:{name:"cross"},on:{click:function(e){return t.deleteThis(n)}}})],1)}))],2),a("div",{directives:[{name:"show",rawName:"v-show",value:t.value,expression:"value"}],staticClass:"search-result"},[a("div",{staticClass:"wrap"},[t.singer.length?a("p",{staticClass:"singer"},[a("van-icon",{attrs:{name:"user-o"}}),a("span",{on:{click:function(e){return t.toSingerPage(t.singer[0].id)}}},[t._v(t._s(t.singer[0].name))])],1):t._e(),t.songsData.length?t._l(t.songsData,(function(e){return a("div",{key:e.id},[a("p",[a("van-icon",{attrs:{name:"music-o"}}),a("span",{on:{click:function(a){return t.addSongPlay(e)}}},[t._v(t._s(t.joinArtists(e.artists))+" - "+t._s(e.name))])],1)])})):t._e()],2),t.songsData.length||t.singer.length?t._e():a("van-loading",{staticClass:"loading",attrs:{type:"spinner",color:"#ffcd32"}})],1)],1)}),[],!1,null,"6b3e9ab8",null);e.default=g.exports},"44e7":function(t,e,a){var n=a("861d"),r=a("c6b6"),s=a("b622")("match");t.exports=function(t){var e;return n(t)&&(void 0!==(e=t[s])?!!e:"RegExp"==r(t))}},"5a34":function(t,e,a){var n=a("da84"),r=a("44e7"),s=n.TypeError;t.exports=function(t){if(r(t))throw s("The method doesn't accept regular expressions");return t}},6062:function(t,e,a){"use strict";a("6d61")("Set",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),a("6566"))},8880:function(t,e,a){"use strict";a("fd19")},ab13:function(t,e,a){var n=a("b622")("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(a){try{return e[n]=!1,"/./"[t](e)}catch(t){}}return!1}},caad:function(t,e,a){"use strict";var n=a("23e7"),r=a("4d64").includes,s=a("44d2");n({target:"Array",proto:!0},{includes:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),s("includes")},fd19:function(t,e,a){}}]);